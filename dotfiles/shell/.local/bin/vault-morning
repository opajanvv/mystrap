#!/bin/bash
# vault-morning: Generate morning routine without LLM
# Replaces: claude -p "/morning"

set -e

VAULT_DIR="$HOME/Obsidian/life"
TODAY_FILE="$VAULT_DIR/TODAY.md"
DATE=$(date +%Y-%m-%d)

cd "$VAULT_DIR"

# Step 1: Process Braintoss inbox
echo "Processing Braintoss inbox..."
braintoss-inbox || echo "braintoss-inbox failed or not available"

# Step 2: Clean up completed items
echo "Cleaning up completed items..."
cleanup_result=$(vault-cleanup 2>/dev/null || echo '{"counts":{"total":0}}')
cleanup_count=$(echo "$cleanup_result" | jq -r '.counts.total // 0')
echo "Cleaned up $cleanup_count items"

# Step 3: Generate TODAY.md
vault-today

# Step 5: Commit and push
echo "Committing and pushing..."
git add -A
if git diff --staged --quiet; then
  echo "No changes to commit"
else
  git commit -m "morning: $DATE"
  git push
  echo "Pushed to remote"
fi

echo "Morning routine complete."
